### Introduction to AWS S3

- S3는 dropbox같은 저장소
- 과정
    1. AWS 가입
    2. S3로 가서 버킷을 만들기
    3. 만든 버킷을 퍼블릭 엑세스로 세팅하기

- 서버가 파일을 업로드 하게 만들기(multer을 사용해서)
    1. AWS에서 IAM으로 이동
    2. User을 추가(프로그래밍 방식 엑세스 체크)
    3. User에게 권한 설정
    4. 기존 정책 직접 연결에서 s3 검색 AmazonS3FullAccess 선택(user가 S3에서 무엇이든 할 수 있게 해줌)
    5. 사용자 생성 후 얻게 되는 ID와 Key는 이 때만 확인 할 수 있으니 주의!!
    6. 내 프로젝트로 돌아와서 npm i aws-sdk multer-3
    7. middlewares에 multer 부분을 수정해주기
    8. multer 가 제공해주던 file에 path가 location으로 바뀐다는 점도 인지

    ```jsx
    import multerS3 from "multer-s3";
    import aws from "aws-sdk";

    const s3 = new aws.S3({
      accessKeyId: process.env.AWS_KEY,
      secretAccessKey: process.env.AWS_PRIVATE_KEY,
      region: "ap-northeast-1"
    });

    const multerVideo = multer({
      storage: multerS3({
        s3,
        acl: "public-read",
        bucket: "wetube/video"
      })
    });
    const multerAvatar = multer({
      storage: multerS3({
        s3,
        acl: "public-read",
        bucket: "wetube/avatar"
      })
    });
    ```

### Blob Duration Bug

- blub의 길이를 알고 싶다면 npm install get-blob-duration
- AWS S3의 버킷에 접근할 수 있도록 CORS 구성을 해주면 끝

```jsx
import getBlobDuration(blob);

//blob src의 파일을 createObjectURL 에러가 떠서 blob를 임시로 받아온 뒤에 시간을 알아내도록 했다.
async function setTotalTime() {
  const blob = await fetch(videoPlayer.src).then((response) => response.blob());
  const duration = await getBlobDuration(blob);
  const totalTimeString = formatDate(duration);
}
```
